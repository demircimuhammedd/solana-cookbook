<!DOCTYPE html>
<html lang="kr-KR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="title" content="Solana Cookbook | Retrying Transactions"><meta name="og:title" content="Solana Cookbook | Retrying Transactions"><meta name="description" content="On some occasions, a seemingly valid transaction may be dropped before it is included in a block. To combat this, application developers are able to develop their own custom rebroadcasting logic. Learn about retrying transactions and more at The Solana cookbook."><meta name="og:description" content="On some occasions, a seemingly valid transaction may be dropped before it is included in a block. To combat this, application developers are able to develop their own custom rebroadcasting logic. Learn about retrying transactions and more at The Solana cookbook."><meta name="og:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="og:image:alt" content="Solana splash card"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@solanacookbook"><meta name="twitter:image" content="https://solanacookbook.com/cookbook-sharing-card.png"><meta name="robots" content="index,follow,noodp"><meta name="googlebot" content="index,follow"><link rel="icon" href="/solana_cookbook_lightmode.svg"><script data-domain="solanacookbook.com" src="https://plausible.io/js/plausible.js"></script><title>Retrying Transactions | Solana Cookbook</title>
    <link rel="modulepreload" href="/assets/app.73200a3f.js"><link rel="modulepreload" href="/assets/retrying-transactions.html.7bf63f72.js"><link rel="modulepreload" href="/assets/retrying-transactions.html.523d15bb.js">
    <link rel="stylesheet" href="/assets/style.fecd2c41.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/kr/" class=""><!----><span class="site-name can-hide">Solana Cookbook</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribute"><!--[--><!--]--> Contribute <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/integrations" class="" aria-label="Integrations"><!--[--><!--]--> Integrations <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/guides/retrying-transactions.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guides/retrying-transactions.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/guides/retrying-transactions.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/guides/retrying-transactions.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/retrying-transactions.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/guides/retrying-transactions.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guides/retrying-transactions.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/kr/guides/retrying-transactions.html" class="router-link-active router-link-exact-active router-link-active" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/guides/retrying-transactions.html" class="" aria-label="Türk"><!--[--><!--]--> Türk <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/solana-developers/solana-cookbook" rel="noopener noreferrer" target="_blank" aria-label="Contribute"><!--[--><!--]--> Contribute <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/integrations" class="" aria-label="Integrations"><!--[--><!--]--> Integrations <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/guides/retrying-transactions.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/zh/" class="" aria-label="中文"><!--[--><!--]--> 中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/guides/retrying-transactions.html" class="" aria-label="Spanish"><!--[--><!--]--> Spanish <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/guides/retrying-transactions.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vi/guides/retrying-transactions.html" class="" aria-label="Tiếng Việt"><!--[--><!--]--> Tiếng Việt <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/th/guides/retrying-transactions.html" class="" aria-label="ไทย"><!--[--><!--]--> ไทย <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/guides/retrying-transactions.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/id/guides/retrying-transactions.html" class="" aria-label="Bahasa Indonesia"><!--[--><!--]--> Bahasa Indonesia <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/kr/guides/retrying-transactions.html" class="router-link-active router-link-exact-active router-link-active" aria-label="한국어"><!--[--><!--]--> 한국어 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/tr/guides/retrying-transactions.html" class="" aria-label="Türk"><!--[--><!--]--> Türk <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Getting Started <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/kr/" class="sidebar-item" aria-label="Cooking with Solana"><!--[--><!--]--> Cooking with Solana <!--[--><!--]--></a><!----></li><li><a href="/kr/getting-started/installation.html" class="sidebar-item" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Core Concepts <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/kr/core-concepts/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/kr/core-concepts/programs.html" class="sidebar-item" aria-label="Programs"><!--[--><!--]--> Programs <!--[--><!--]--></a><!----></li><li><a href="/kr/core-concepts/transactions.html" class="sidebar-item" aria-label="Transactions"><!--[--><!--]--> Transactions <!--[--><!--]--></a><!----></li><li><a href="/kr/core-concepts/pdas.html" class="sidebar-item" aria-label="Program Derived Addresses (PDAs)"><!--[--><!--]--> Program Derived Addresses (PDAs) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Guides <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/kr/guides/get-program-accounts.html" class="sidebar-item" aria-label="Get Program Accounts"><!--[--><!--]--> Get Program Accounts <!--[--><!--]--></a><!----></li><li><a href="/kr/guides/serialization.html" class="sidebar-item" aria-label="Serializing Data"><!--[--><!--]--> Serializing Data <!--[--><!--]--></a><!----></li><li><a href="/kr/guides/data-migration.html" class="sidebar-item" aria-label="Migrating Program Data Accounts"><!--[--><!--]--> Migrating Program Data Accounts <!--[--><!--]--></a><!----></li><li><a href="/kr/guides/account-maps.html" class="sidebar-item" aria-label="Account Maps"><!--[--><!--]--> Account Maps <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Retrying Transactions"><!--[--><!--]--> Retrying Transactions <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#facts" class="router-link-active router-link-exact-active sidebar-item" aria-label="Facts"><!--[--><!--]--> Facts <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#the-journey-of-a-transaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="The Journey of a Transaction"><!--[--><!--]--> The Journey of a Transaction <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#how-clients-submit-transactions" class="router-link-active router-link-exact-active sidebar-item" aria-label="How Clients Submit Transactions"><!--[--><!--]--> How Clients Submit Transactions <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#how-rpc-nodes-broadcast-transactions" class="router-link-active router-link-exact-active sidebar-item" aria-label="How RPC Nodes Broadcast Transactions"><!--[--><!--]--> How RPC Nodes Broadcast Transactions <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#how-transactions-get-dropped" class="router-link-active router-link-exact-active sidebar-item" aria-label="How Transactions Get Dropped"><!--[--><!--]--> How Transactions Get Dropped <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#before-a-transaction-is-processed" class="router-link-active router-link-exact-active sidebar-item" aria-label="Before a transaction is processed"><!--[--><!--]--> Before a transaction is processed <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#after-a-transaction-is-processed-and-before-it-is-finalized" class="router-link-active router-link-exact-active sidebar-item" aria-label="After a transaction is processed and before it is finalized"><!--[--><!--]--> After a transaction is processed and before it is finalized <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#handling-dropped-transactions" class="router-link-active router-link-exact-active sidebar-item" aria-label="Handling Dropped Transactions"><!--[--><!--]--> Handling Dropped Transactions <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#an-in-depth-look-at-sendtransaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="An In-Depth Look at sendTransaction"><!--[--><!--]--> An In-Depth Look at sendTransaction <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#customizing-rebroadcast-logic" class="router-link-active router-link-exact-active sidebar-item" aria-label="Customizing Rebroadcast Logic"><!--[--><!--]--> Customizing Rebroadcast Logic <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#the-cost-of-skipping-preflight" class="router-link-active router-link-exact-active sidebar-item" aria-label="The Cost of Skipping Preflight"><!--[--><!--]--> The Cost of Skipping Preflight <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#when-to-re-sign-transactions" class="router-link-active router-link-exact-active sidebar-item" aria-label="When to Re-Sign Transactions"><!--[--><!--]--> When to Re-Sign Transactions <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/kr/guides/retrying-transactions.html#acknowledgements" class="router-link-active router-link-exact-active sidebar-item" aria-label="Acknowledgements"><!--[--><!--]--> Acknowledgements <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/kr/guides/debugging-solana-programs.html" class="sidebar-item" aria-label="Debugging Solana Programs"><!--[--><!--]--> Debugging Solana Programs <!--[--><!--]--></a><!----></li><li><a href="/kr/guides/feature-parity-testing.html" class="sidebar-item" aria-label="Feature Parity Testing"><!--[--><!--]--> Feature Parity Testing <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading">References <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/kr/references/local-development.html" class="sidebar-item" aria-label="Local Development"><!--[--><!--]--> Local Development <!--[--><!--]--></a><!----></li><li><a href="/kr/references/keypairs-and-wallets.html" class="sidebar-item" aria-label="Keypairs and Wallets"><!--[--><!--]--> Keypairs and Wallets <!--[--><!--]--></a><!----></li><li><a href="/kr/references/basic-transactions.html" class="sidebar-item" aria-label="Sending Transactions"><!--[--><!--]--> Sending Transactions <!--[--><!--]--></a><!----></li><li><a href="/kr/references/accounts.html" class="sidebar-item" aria-label="Accounts"><!--[--><!--]--> Accounts <!--[--><!--]--></a><!----></li><li><a href="/kr/references/programs.html" class="sidebar-item" aria-label="Writing Programs"><!--[--><!--]--> Writing Programs <!--[--><!--]--></a><!----></li><li><a href="/kr/references/token.html" class="sidebar-item" aria-label="Interacting with Tokens"><!--[--><!--]--> Interacting with Tokens <!--[--><!--]--></a><!----></li><li><a href="/kr/references/staking.html" class="sidebar-item" aria-label="Staking"><!--[--><!--]--> Staking <!--[--><!--]--></a><!----></li><li><a href="/kr/references/nfts.html" class="sidebar-item" aria-label="NFTs"><!--[--><!--]--> NFTs <!--[--><!--]--></a><!----></li><li><a href="/kr/references/offline-transactions.html" class="sidebar-item" aria-label="Sending Offline Transactions"><!--[--><!--]--> Sending Offline Transactions <!--[--><!--]--></a><!----></li><li><a href="/kr/references/name-service.html" class="sidebar-item" aria-label="Name Service"><!--[--><!--]--> Name Service <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="retrying-transactions" tabindex="-1"><a class="header-anchor" href="#retrying-transactions" aria-hidden="true">#</a> Retrying Transactions</h1><p>몇몇 상황에서 유효해 보이는 Trasaction이 block에 포함되기 전에 거절될지도 모릅니다. RPC 노드가 <a href="https://docs.solana.com/terminology#leader" target="_blank" rel="noopener noreferrer">leader<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>에게 그 Transaction을 rebroadcast 하는 것을 실패하는 상황 같은, 네트워크가 혼잡한 동안에 종종 발생합니다. 이것은 end-user에게 그들의 Transaction이 완전히 사라진 것처럼 보일지도 모릅니다. RPC 노드들은 generic rebroadcasting 알고리즘을 갖추고 있지만, application 개발자들은 자신만의 cutom rebroadcasting logic을 만들 수도 있습니다.</p><h2 id="facts" tabindex="-1"><a class="header-anchor" href="#facts" aria-hidden="true">#</a> Facts</h2><div class="custom-container tip"><p class="custom-container-title">Fact Sheet</p><ul><li>RPC 노드들은 Transaction에 대한 generic 알고리즘을 사용해서 rebroadcast를 시도할 것입니다.</li><li>Application 개발자들은 자신만의 custom rebroadcasting logic을 구현할 수 있습니다.</li><li>개발자들은 <code>sendTransaction</code> JSON-RPC 메소드에 있는 <code>maxRetries</code> 파라미터의 이점을 활용해야 합니다.</li><li>개발자들은 Transaction이 보내지기 전에 error들을 발생시키기 위한 앞선 check들을 가능하게 해야합니다.</li><li>어떤 Transaction에 다시 서명하기 전에, 첫 Transaction의 Blockhash가 만료됐는지 확인하는 것은 매우 중요합니다.</li></ul></div><h2 id="the-journey-of-a-transaction" tabindex="-1"><a class="header-anchor" href="#the-journey-of-a-transaction" aria-hidden="true">#</a> The Journey of a Transaction</h2><h3 id="how-clients-submit-transactions" tabindex="-1"><a class="header-anchor" href="#how-clients-submit-transactions" aria-hidden="true">#</a> How Clients Submit Transactions</h3><p>Solana에는 mempool에 대한 개념이 없습니다. 프로그램이나 end-user에 의해 초기화된 모든 Transaction들은 block 안으로 처리될 수 있게 효율적으로 leader들에게 라우팅 됩니다. Transaction이 leader들에게 보내질 수 있는 두 가지 주된 방법이 있습니다:</p><ol><li>RPC 서버를 통한 Proxy 그리고 <a href="https://docs.solana.com/developing/clients/jsonrpc-api#sendtransaction" target="_blank" rel="noopener noreferrer">sendTransaction<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> JSON-RPC method에 의해</li><li><a href="https://docs.rs/solana-client/1.7.3/solana_client/tpu_client/index.html" target="_blank" rel="noopener noreferrer">TPU Client<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>를 통해 leader들에게 직접</li></ol><p>대부분의 end-user들은 RPC 서버를 통해 Transaction들을 보낼 것입니다. Client가 Transaction을 보낼 때, 수신한 RPC node는 Transaction을 현재와 다음 leader들에게 차례로 broadcast 할 것입니다. Transaction이 leader에 의해 처리될 때까지 Client와 전달 중인 RPC 노드들이 알고 있는 것 외부에는 그 Transaction에 대한 기록이 존재하지 않을 것입니다. TPC Client의 경우, rebroadcast와 leader forwarding은 온전히 Client software에 의해 다뤄집니다.</p><p><img src="/assets/tx-journey.dd6310be.png" alt="Transaction Journey"></p><h3 id="how-rpc-nodes-broadcast-transactions" tabindex="-1"><a class="header-anchor" href="#how-rpc-nodes-broadcast-transactions" aria-hidden="true">#</a> How RPC Nodes Broadcast Transactions</h3><p>RPC노드는 <code>sendTransaction</code>을 통해 Transaction을 수신한 후에, 관련된 leader들에게 전달하기 전에 Transaction을 <a href="https://en.wikipedia.org/wiki/User_Datagram_Protocol" target="_blank" rel="noopener noreferrer">UDP<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 패킷으로 변환할 것입니다. UDP는 validator들이 빠르게 서로 통신할 수 있게 해주지만, Transcation 전달을 보장하지는 않습니다.</p><p>Solana의 leader 스케줄은 매 <a href="https://docs.solana.com/terminology#epoch" target="_blank" rel="noopener noreferrer">epoch<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 보다 앞선 것으로 알려져 있기 때문에 (~2 days), RPC 노드는 Transaction을 현재와 다음 leader들에게 즉시 broadcast 할 것입니다. 이것은 Transaction들을 전체 네트워크에 랜덤하게 전파하는 Ethereum과 같은 다른 프로토콜들과 다른 것입니다. 기본적으로, RPC 노드들은 Transaction이 종결되거나 Transaction의 Blockhash가 만료(150 blocks or ~1 분 19초, 이 글 작성 시점 기준)될 때까지 매 2초 마다 Trnasaction들을 보내는 시도를 할 것입니다. 만약 아직 처리되지 않은 rebroadcast의 큐 사이즈가 <a href="https://github.com/solana-labs/solana/blob/bfbbc53dac93b3a5c6be9b4b65f679fdb13e41d9/send-transaction-service/src/send_transaction_service.rs#L20" target="_blank" rel="noopener noreferrer">10,000 transactions<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 보다 크다면, 새로 보내지는 Transaction들은 드랍될 것입니다. 이러한 재시도 로직의 기본 행위를 변경하기 위해 RPC 운영자들이 조정할 수 있는 command-line <a href="https://github.com/solana-labs/solana/blob/bfbbc53dac93b3a5c6be9b4b65f679fdb13e41d9/validator/src/main.rs#L1172" target="_blank" rel="noopener noreferrer">arguments<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>들이 존재합니다.</p><p>RPC 노드가 Transaction을 broadcast할 때, 노드는 이 Transaction을 leader의 <a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/validator.rs#L867" target="_blank" rel="noopener noreferrer">Transaction Processing Unit (TPU)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>에 보내려고 할 것입니다. TPU는 Transaction들을 다섯 단계로 처리합니다:</p><ul><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/fetch_stage.rs#L21" target="_blank" rel="noopener noreferrer">Fetch Stage<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/tpu.rs#L91" target="_blank" rel="noopener noreferrer">SigVerify Stage<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/banking_stage.rs#L249" target="_blank" rel="noopener noreferrer">Banking Stage<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/poh/src/poh_service.rs" target="_blank" rel="noopener noreferrer">Proof of History Service<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/core/src/tpu.rs#L136" target="_blank" rel="noopener noreferrer">Broadcast Stage<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p><img src="/assets/tpu-jito-labs.8bb32fb6.png" alt="TPU Overview"><small style="display:block;text-align:center;">Image Courtesy of Jito Labs</small></p><p>이 다섯 단계 중 Fetch Stage는 Transaction들을 수신하는 책임을 갖습니다. Fetch Stage에서 validator들은 들어오는 Transaction들을 3가지 포트에 따라 분류할 것입니다.</p><ul><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L27" target="_blank" rel="noopener noreferrer">tpu<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>는 token 전송들, NFT mint들 그리고 Program Instruction들과 같은 일반적인 Transaction들을 다룹니다.</li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L31" target="_blank" rel="noopener noreferrer">tpu_vote<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>는 voting Transaction들을 집중적으로 다룹니다.</li><li><a href="https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/gossip/src/contact_info.rs#L29" target="_blank" rel="noopener noreferrer">tpu_forwards<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>는 만약 현재 leader가 모든 Transaction들을 처리할 수 없다면 가공되지 않은 패킷들을 다음 leader에게 보냅니다.</li></ul><p>TPU에 대한 더 많은 정보는 다음을 참고해주세요. <a href="https://jito-labs.medium.com/solana-validator-101-transaction-processing-90bcdc271143" target="_blank" rel="noopener noreferrer">this excellent writeup by Jito Labs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h2 id="how-transactions-get-dropped" tabindex="-1"><a class="header-anchor" href="#how-transactions-get-dropped" aria-hidden="true">#</a> How Transactions Get Dropped</h2><p>Transaction의 여정 동안에 Transaction이 의도치 않게 네트워크로부터 드랍될 수 있는 몇 가지 시나리오들이 존재합니다.</p><h3 id="before-a-transaction-is-processed" tabindex="-1"><a class="header-anchor" href="#before-a-transaction-is-processed" aria-hidden="true">#</a> Before a transaction is processed</h3><p>만약 네트워크가 Transaction을 드랍한다면, 이것은 대부분 Transaction이 leader에 의해 처리되기 전 일 것입니다. UDP <a href="https://en.wikipedia.org/wiki/Packet_loss" target="_blank" rel="noopener noreferrer">packet loss<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>는 이것이 발생하는 가장 단순한 이유입니다. 네트워크에 심한 부하가 걸리는 동안, validator들은 처리를 요청받은 Transaction들의 수에 의해 압도될 수 있습니다. validator들은 과도한 Transaction들을 <code>tpu_forwards</code>를 통해 보낼 수도 있지만, <a href="https://github.com/solana-labs/solana/blob/master/core/src/banking_stage.rs#L389" target="_blank" rel="noopener noreferrer">forwarded<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 수 있는 데이터 양에 대한 제한이 있습니다. 뿐만 아니라, 각 forward는 validator들 사이에 단일 홉으로 제한되어 있습니다. <code>tpu_forwards</code> 포트를 통해 수신된 Transaction들이 다른 validator들에게 보내지지 않는 이유입니다.</p><p>Trnasaction이 처리되기 전 드랍될 수 있는 덜 알려진 두 가지 이유도 있습니다. 첫 번째 시나리오는 RPC 풀을 통해 보내진 Transaction들을 호출합니다. 가끔 RPC 풀의 한 부분이 풀의 나머지 부분보다 앞서 있을 수 있습니다. 이것은 풀 안에 있는 노드들이 함께 동작하도록 요청될 때 이슈를 야기할 수 있습니다. 이 예제에서, Transaction의 <a href="https://docs.solana.com/developing/programming-model/transactions#recent-blockhash" target="_blank" rel="noopener noreferrer">recentBlockhash<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>는 풀의 앞선 부분으로부터 질의를 받습니다 (Backend A). Transaction이 풀의 뒤떨어진 부분에 보내질 때, 노드들은 앞선 blockhash 라는 것을 알아차릴 것이고 Transaction을 드랍할 것입니다. 만약 개발자들이 <code>sendTransaction</code>에 <a href="https://docs.solana.com/developing/clients/jsonrpc-api#sendtransaction" target="_blank" rel="noopener noreferrer">preflight checks<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>를 가능하게 한다면 Transaction이 보내지기 전에 이것을 발견할 수 있습니다.</p><p><img src="/assets/dropped-via-rpc-pool.8d1ce9af.png" alt="Dropped via RPC Pool"></p><p>일시적인 네트워크 포크 또한 Transaction들을 드랍시키는 결과를 야기할 수 있습니다. 만약 validator가 Banking Stage 내에서 block들을 느리게 재생한다면, 결국 minority fork를 생성해낼지 모릅니다. Client가 Transaction을 만들 때, 그 Transaction이 오직 minority fork에만 존재하는 <code>recentBlockhash</code>를 참조하도록 할 수 있습니다. 그 Transaction이 보내지고 나면, 그 Transaction이 처리되기 전에 cluster가 minority fork를 바꿔버릴 수 있습니다. 이 시나리오에서, blockhash는 발견될 수 없기 때문에 그 Transaction은 드랍됩니다.</p><p><img src="/assets/dropped-minority-fork-pre-process.555653e1.png" alt="Dropped due to Minority Fork (Before Processed)"></p><h3 id="after-a-transaction-is-processed-and-before-it-is-finalized" tabindex="-1"><a class="header-anchor" href="#after-a-transaction-is-processed-and-before-it-is-finalized" aria-hidden="true">#</a> After a transaction is processed and before it is finalized</h3><p>Transaction이 minority fork로부터 <code>recentBlockhash</code>를 호출한 경우에도 Transaction이 처리될 수도 있습니다. 그러나, 이런 경우에는 minority fork에 있는 leader에 의해 처리될 것입니다. 이 leader가 처리한 Transaction들을 나머지 네트워크와 공유하려고 할 때, minority fork를 인정하지 않는 majority of validator들과의 합의에 실패할 것입니다. 이때, 그 Transaction은 완료되기 전에 드랍될 것입니다.</p><p><img src="/assets/dropped-minority-fork-post-process.48c3c955.png" alt="Dropped due to Minority Fork (After Processed)"></p><h2 id="handling-dropped-transactions" tabindex="-1"><a class="header-anchor" href="#handling-dropped-transactions" aria-hidden="true">#</a> Handling Dropped Transactions</h2><p>RPC 노드들이 Transaction들을 rebroadcast 시도할 동안, 그들이 쓰는 알고리즘은 포괄적이고 특정 앱의 요구와는 종종 어울리지 않습니다. 네트워크 혼잡에 대비하기 위해, application 개발자들은 그들 자신의 rebroadcasting logic을 customize 해야 합니다.</p><h3 id="an-in-depth-look-at-sendtransaction" tabindex="-1"><a class="header-anchor" href="#an-in-depth-look-at-sendtransaction" aria-hidden="true">#</a> An In-Depth Look at sendTransaction</h3><p>Transaction들을 보내는 것에 대해서는 <code>sendTransaction</code> RPC method가 개발자들에게 가장 중요한 도구입니다. <code>sendTransaction</code>은 단지 Transaction을 client에서 RPC node로 보내는 데 책임이 있습니다. 만약 node가 Transaction을 수신하면, <code>sendTransaction</code>은 그 Transaction을 추적하기 위해 사용될 수 있는 Transaction id를 응답할 것입니다. 성공적인 응답이 그 Transaction이 cluster에 의해 처리되거나 완료될 것인지를 나타내지는 않습니다.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><h4 id="request-parameters" tabindex="-1"><a class="header-anchor" href="#request-parameters" aria-hidden="true">#</a> Request Parameters</h4><ul><li><code>transaction</code>: <code>string</code> - 인코딩 된 문자열로 완전하게 서명된 Transaction</li><li>(optional) <code>configuration object</code>: <code>object</code><ul><li><code>skipPreflight</code>: <code>boolean</code> - true 라면, 보내기 전 Transaction check를 건너뜁니다. (default: false)</li><li>(optional) <code>preflightCommitment</code>: <code>string</code> - bank slot과 반대되는 보내기 전 시뮬레이션을 위해 사용할 <a href="https://docs.solana.com/developing/clients/jsonrpc-api#configuring-state-commitment" target="_blank" rel="noopener noreferrer">Commitment<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 레벨 (default: &quot;finalized&quot;).</li><li>(optional) <code>encoding</code>: <code>string</code> - Transaction Data를 위해 사용되는 인코딩. &quot;base58&quot; (slow), 또는 &quot;base64&quot;. (default: &quot;base58&quot;).</li><li>(optional) <code>maxRetries</code>: <code>usize</code> - RPC node가 leader에게 Transaction 보내는 것을 재시도할 최대 횟수. 만약 이 파라미터가 값이 세팅되지 않는다면, RPC node는 Transaction이 완료되거나 blockhash가 만료될 때까지 재시도할 것입니다.</li></ul></li></ul><h4 id="response" tabindex="-1"><a class="header-anchor" href="#response" aria-hidden="true">#</a> Response</h4><ul><li><code>transaction id</code>: <code>string</code> - base-58로 인코딩된 문자열로 Transaction에 담긴 첫 번째 Transaction 시그니처. 이 Transaction id는 상태 updates들을 조사하기 위해 <a href="https://docs.solana.com/developing/clients/jsonrpc-api#getsignaturestatuses" target="_blank" rel="noopener noreferrer">getSignatureStatuses<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>와 함께 사용될 수 있습니다.</li></ul></div><h2 id="customizing-rebroadcast-logic" tabindex="-1"><a class="header-anchor" href="#customizing-rebroadcast-logic" aria-hidden="true">#</a> Customizing Rebroadcast Logic</h2><p>자신만의 rebroadcasting logic을 개발하기 위해서, 개발자들은 <code>sendTransaction</code>의 <code>maxRetries</code> 파라미터의 이점을 활용해야 합니다. 만약 적용된다면, 개발자들이 <a href="https://github.com/solana-labs/solana/blob/98707baec2385a4f7114d2167ef6dfb1406f954f/validator/src/main.rs#L1258-L1274" target="_blank" rel="noopener noreferrer">within reasonable bounds<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 재시도 처리를 수동으로 다룰 수 있게 해 주며, <code>maxRetries</code>가 RPC 노드의 기본 retry logic을 덮어쓸 것입니다.</p><p>Transaction들을 수동으로 재시도하는 것을 위한 흔한 패턴은 일시적으로 <a href="https://docs.solana.com/developing/clients/jsonrpc-api#getlatestblockhash" target="_blank" rel="noopener noreferrer">getLatestBlockhash<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>으로부터 얻을 수 있는 <code>lastValidBlockHeight</code>를 저장하도록 호출하는 것입니다. 일단 저장되고 나면, 이제 Application은 <a href="https://docs.solana.com/developing/clients/jsonrpc-api#getblockheight" target="_blank" rel="noopener noreferrer">poll the cluster’s blockheight<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>할 수 있고 적절한 간격으로 수동으로 Transaction을 재시도할 수 있습니다. 네트워크가 혼잡할 때는 <code>maxRetries</code>를 0으로 세팅하고 custom algorithm을 통해 수동으로 rebroadcast하는 것이 유리합니다. 어떤 Application들은 <a href="https://en.wikipedia.org/wiki/Exponential_backoff" target="_blank" rel="noopener noreferrer">exponential backoff<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> algorithm을 사용할수도 있고, 다른 Application들은 타임아웃이 일어날 때까지 일정한 간격으로 Transaction들을 <a href="https://github.com/blockworks-foundation/mango-ui/blob/b6abfc6c13b71fc17ebbe766f50b8215fa1ec54f/src/utils/send.tsx#L713" target="_blank" rel="noopener noreferrer">continuously resubmit<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>하기 위해 <a href="https://www.mango.markets/" target="_blank" rel="noopener noreferrer">Mango<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> opt를 사용할 수도 있습니다.</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><!--[--><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">TS</button></li><!--]--><li class="flex-grow"></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg></button></li><li class="code-group__li"><button class="code-group__nav-tab"><svg width="18" height="18" viewbox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg></button></li></ul></div><div><div class="code-info-title">Press &lt;/&gt; button to view full source</div></div><!--[--><div class="code-group-item code-group-item__active" aria-selected="true" data-v-6ae3d40e><div class="" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Keypair<span class="token punctuation">,</span>
  Connection<span class="token punctuation">,</span>
  <span class="token constant">LAMPORTS_PER_SOL</span><span class="token punctuation">,</span>
  SystemProgram<span class="token punctuation">,</span>
  Transaction<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@solana/web3.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> nacl <span class="token keyword">from</span> <span class="token string">&quot;tweetnacl&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>ms<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> payer <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> toAccount <span class="token operator">=</span> Keypair<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">;</span>

  <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connection</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8899&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;confirmed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> airdropSignature <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">requestAirdrop</span><span class="token punctuation">(</span>
    payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    <span class="token constant">LAMPORTS_PER_SOL</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">confirmTransaction</span><span class="token punctuation">(</span>airdropSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> blockhashResponse <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getLatestBlockhashAndContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lastValidBlockHeight <span class="token operator">=</span> blockhashResponse<span class="token punctuation">.</span>context<span class="token punctuation">.</span>slot <span class="token operator">+</span> <span class="token number">150</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> transaction <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    feePayer<span class="token operator">:</span> payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
    blockhash<span class="token operator">:</span> blockhashResponse<span class="token punctuation">.</span>value<span class="token punctuation">.</span>blockhash<span class="token punctuation">,</span>
    lastValidBlockHeight<span class="token operator">:</span> lastValidBlockHeight<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
    SystemProgram<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      fromPubkey<span class="token operator">:</span> payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span>
      toPubkey<span class="token operator">:</span> toAccount<span class="token punctuation">,</span>
      lamports<span class="token operator">:</span> <span class="token number">1000000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">serializeMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> signature <span class="token operator">=</span> nacl<span class="token punctuation">.</span>sign<span class="token punctuation">.</span><span class="token function">detached</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> payer<span class="token punctuation">.</span>secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  transaction<span class="token punctuation">.</span><span class="token function">addSignature</span><span class="token punctuation">(</span>payer<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> rawTransaction <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> blockheight <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBlockHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>blockheight <span class="token operator">&lt;</span> lastValidBlockHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    connection<span class="token punctuation">.</span><span class="token function">sendRawTransaction</span><span class="token punctuation">(</span>rawTransaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      skipPreflight<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    blockheight <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBlockHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><!--]--></div><div class="hidden" data-v-6ae3d40e><!--[--><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">while</span> <span class="token punctuation">(</span>blockheight <span class="token operator">&lt;</span> lastValidBlockHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  connection<span class="token punctuation">.</span><span class="token function">sendRawTransaction</span><span class="token punctuation">(</span>rawTransaction<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    skipPreflight<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  blockheight <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">getBlockHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><!--]--></div></div><!--]--></div><p><code>getLastestBlockhash</code>를 통해 가져올 때, Application들은 그들의 의도된 <a href="https://docs.solana.com/developing/clients/jsonrpc-api#configuring-state-commitment" target="_blank" rel="noopener noreferrer">commitment<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> level을 명시해야 합니다. commitment를 <code>confirmed</code> (voted on) 또는 <code>finalized</code> (~30 blocks after <code>confirmed</code>)으로 세팅함으로써, Application은 minority fork로 부터 blockhash를 가져오는 것을 피할 수 있습니다.</p><p>Application이 만약 load balancer 뒤의 RPC node들에 접근할 수 있다면, 특정 노드들 사이에서 작업량을 나누도록 선택할 수 있습니다. <a href="/kr/guides/get-program-accounts.html" class="">getProgramAccounts</a>와 같은 data 집중적인 요청들을 제공하는 RPC 노드들 뒤떨어지기 쉽고 Transaction들을 보내기 또한 적절하지 않을 수 있습니다. 시간에 민감한 Transaction들을 다루는 Application들에게, <code>sendTransaction</code>만을 다루는 node들을 선택하는 것은 prudent할지 모릅니다.</p><h3 id="the-cost-of-skipping-preflight" tabindex="-1"><a class="header-anchor" href="#the-cost-of-skipping-preflight" aria-hidden="true">#</a> The Cost of Skipping Preflight</h3><p>기본적으로 <code>sendTransaction</code>은 Transaction을 보내기에 앞서 세 가지 preflight checks를 수행합니다. 구체적으로:</p><ul><li>모든 서명들이 유효한지 검증합니다.</li><li>참조된 blockhash가 최근 150 blocks 안에 포함되는지 체크합니다.</li><li><code>preflightcommitment</code>에 의해 명시된 bank slot에 대하여 Transaction을 시뮬레이션합니다.</li></ul><p>만약 이 세 가지 preflight check가 실패하는 경우, <code>sendTransaction</code>은 Transaction을 보내기 전에 에러를 일으킬 것입니다. Preflight checks는 Transaction을 잃어버리는 것과 client가 우아하게 error를 다루도록 하는 것 사이의 차이를 만들어 낼 수 있습니다. 이런 흔한 에러들이 설명되도록 하고 싶다면, 개발자들이 <code>skipPreflight</code>을 <code>false</code> 값으로 유지하는 것을 추천합니다.</p><h3 id="when-to-re-sign-transactions" tabindex="-1"><a class="header-anchor" href="#when-to-re-sign-transactions" aria-hidden="true">#</a> When to Re-Sign Transactions</h3><p>모든 rebroadcast 시도에도 불구하고, Client가 Transaction에 다시 서명하도록 요구되는 시점들이 있을 수 있습니다. Transaction에 재서명하기 전에, 첫 번째 Transaction의 blockhash가 만료되었다는 것을 확인하는 것은 <strong>매우 중요</strong>합니다. 만약 첫 번째 blockhash가 여전히 유효하다면, 이 두 Transaction들이 network에 받아들여질 수도 있습니다. 이것은 end-user에게 의도치 않게 동일한 Transaction을 두 번 보내는 결과를 보여줄 것입니다.</p><p>Solana에서 드랍된 Transaction은 이 Transaction이 참조하는 blockhash가 <code>getLatestBlockhash</code>로부터 수신된 <code>lastValidBlockHeight</code>보다 오래된 상태가 됬을 때 안전하게 버려질 수 있습니다. 개발자들은 <a href="https://docs.solana.com/developing/clients/jsonrpc-api#getepochinfo" target="_blank" rel="noopener noreferrer"><code>getEpochInfo</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>를 질의하는 것과 응답 값에 있는 <code>blockHeight</code>와 비교하는 것으로 <code>lastValidBlockHeight</code>를 추적해야 합니다. blockhash가 유효하지 않게 되면 Client들은 새롭게 질의한 blockhash를 가지고 다시 서명해야 할 것입니다.</p><h2 id="acknowledgements" tabindex="-1"><a class="header-anchor" href="#acknowledgements" aria-hidden="true">#</a> Acknowledgements</h2><p>Trent Nelson, <a href="https://twitter.com/jacobvcreech" target="_blank" rel="noopener noreferrer">Jacob Creech<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, White Tiger, Le Yafo, <a href="https://twitter.com/buffalu__" target="_blank" rel="noopener noreferrer">Buffalu<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, and <a href="https://twitter.com/jito_labs" target="_blank" rel="noopener noreferrer">Jito Labs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. 이 모든 분들의 리뷰와 피드백에 감사드립니다.</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/kr/guides/account-maps.html" class="" aria-label="Account Maps"><!--[--><!--]--> Account Maps <!--[--><!--]--></a></span><span class="next"><a href="/kr/guides/debugging-solana-programs.html" class="" aria-label="Debugging Solana Programs"><!--[--><!--]--> Debugging Solana Programs <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.73200a3f.js" defer></script>
  </body>
</html>
